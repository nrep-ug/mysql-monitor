"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[527],{1301:function(e,t,n){n.d(t,{Z:function(){return N}});var r=n(7437),s=n(2265),a=n(1396),c=n.n(a),l=n(4033),o=n(8333),i=n(9654),u=n(2824),d=n(6716),m=n(6344),h=n(8427),f=n(5119),x=n(998),g=n(5750),p=n(9409),j=n(7332),b=n(8004),v=n(5883);function N(e){let{children:t}=e,{user:n,logout:a}=(0,o.a)(),N=(0,l.usePathname)(),[k,S]=(0,s.useState)(!1),y=()=>S(!1),w=[{name:"Dashboard",href:"/dashboard",icon:f.Z},{name:"Status History",href:"/dashboard/history",icon:x.Z},{name:"User Management",href:"/dashboard/users",icon:g.Z},{name:"Settings",href:"/dashboard/settings",icon:p.Z}];return(0,r.jsxs)("div",{className:"d-flex",children:[(0,r.jsx)(i.Z,{expand:!1,className:"bg-light d-lg-none w-100 mb-3",fixed:"top",children:(0,r.jsxs)(u.Z,{fluid:!0,children:[(0,r.jsxs)(i.Z.Brand,{href:"/dashboard",className:"d-flex align-items-center",children:[(0,r.jsx)(j.Z,{className:"me-2",size:24}),(0,r.jsx)("span",{children:"NREP Monitor"})]}),(0,r.jsx)(i.Z.Toggle,{"aria-controls":"sidebar-nav",onClick:()=>S(!0),as:d.Z,variant:"outline-primary",children:(0,r.jsx)(b.Z,{size:20})})]})}),(0,r.jsxs)(m.Z,{show:k,onHide:y,placement:"start",className:"w-75 max-w-300",style:{maxWidth:"300px"},children:[(0,r.jsx)(m.Z.Header,{closeButton:!0,children:(0,r.jsxs)(m.Z.Title,{className:"d-flex align-items-center",children:[(0,r.jsx)(j.Z,{className:"me-2",size:24}),(0,r.jsx)("span",{children:"NREP Monitor"})]})}),(0,r.jsx)(m.Z.Body,{className:"p-0",children:(0,r.jsxs)("div",{className:"d-flex flex-column h-100",children:[(0,r.jsx)(h.Z,{className:"flex-column p-3",children:w.map(e=>(0,r.jsxs)(h.Z.Link,{as:c(),href:e.href,className:"d-flex align-items-center py-2 ".concat(N===e.href?"active":""),onClick:y,children:[(0,r.jsx)(e.icon,{className:"me-3",size:18}),e.name]},e.name))}),(0,r.jsxs)("div",{className:"mt-auto p-3 border-top",children:[(0,r.jsxs)("div",{className:"d-flex align-items-center mb-3",children:[(0,r.jsx)("div",{className:"d-flex align-items-center justify-content-center bg-primary text-white rounded-circle me-2",style:{width:"32px",height:"32px"},children:null==n?void 0:n.username.charAt(0).toUpperCase()}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"mb-0 fw-medium",children:null==n?void 0:n.username}),(0,r.jsx)("p",{className:"mb-0 text-muted small",children:null==n?void 0:n.email})]})]}),(0,r.jsxs)(d.Z,{variant:"outline-danger",className:"w-100 d-flex align-items-center justify-content-center",onClick:a,children:[(0,r.jsx)(v.Z,{size:16,className:"me-2"}),"Logout"]})]})]})})]}),(0,r.jsxs)("div",{className:"sidebar bg-light d-none d-lg-flex flex-column",children:[(0,r.jsxs)("div",{className:"p-3 border-bottom d-flex align-items-center",children:[(0,r.jsx)(j.Z,{className:"me-2",size:24}),(0,r.jsx)("h5",{className:"mb-0 fw-bold",children:"NREP Monitor"})]}),(0,r.jsx)(h.Z,{className:"flex-column p-3",children:w.map(e=>(0,r.jsxs)(h.Z.Link,{as:c(),href:e.href,className:"d-flex align-items-center py-2 ".concat(N===e.href?"active":""),children:[(0,r.jsx)(e.icon,{className:"me-3",size:18}),e.name]},e.name))}),(0,r.jsxs)("div",{className:"mt-auto p-3 border-top",children:[(0,r.jsxs)("div",{className:"d-flex align-items-center mb-3",children:[(0,r.jsx)("div",{className:"d-flex align-items-center justify-content-center bg-primary text-white rounded-circle me-2",style:{width:"32px",height:"32px"},children:null==n?void 0:n.username.charAt(0).toUpperCase()}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"mb-0 fw-medium",children:null==n?void 0:n.username}),(0,r.jsx)("p",{className:"mb-0 text-muted small",children:null==n?void 0:n.email})]})]}),(0,r.jsxs)(d.Z,{variant:"outline-danger",className:"w-100 d-flex align-items-center justify-content-center",onClick:a,children:[(0,r.jsx)(v.Z,{size:16,className:"me-2"}),"Logout"]})]})]}),(0,r.jsxs)("div",{className:"main-content",children:[(0,r.jsx)("div",{className:"d-lg-none",style:{height:"56px"}}),t]})]})}},8333:function(e,t,n){n.d(t,{H:function(){return c},a:function(){return l}});var r=n(7437),s=n(2265);let a=(0,s.createContext)(void 0);function c(e){let{children:t}=e,[n,c]=(0,s.useState)(null),[l,o]=(0,s.useState)(null),[i,u]=(0,s.useState)(!0),[d,m]=(0,s.useState)(null);(0,s.useEffect)(()=>{let e=localStorage.getItem("token"),t=localStorage.getItem("user");e&&t&&(o(e),c(JSON.parse(t))),u(!1)},[]);let h=async(e,t)=>{u(!0),m(null);try{let n=await fetch("".concat("https://nrepserver.derrickml.com","/api/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}),r=await n.json();if(!n.ok)throw Error(r.error||"Login failed");o(r.token),c(r.user),localStorage.setItem("token",r.token),localStorage.setItem("user",JSON.stringify(r.user))}catch(e){m(e instanceof Error?e.message:"An unknown error occurred")}finally{u(!1)}},f=async(e,t,n)=>{u(!0),m(null);try{let r=await fetch("".concat("https://nrepserver.derrickml.com","/api/register"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(l)},body:JSON.stringify({username:e,email:t,password:n})}),s=await r.json();if(!r.ok)throw Error(s.error||"Registration failed")}catch(e){throw m(e instanceof Error?e.message:"An unknown error occurred"),e}finally{u(!1)}};return(0,r.jsx)(a.Provider,{value:{user:n,token:l,login:h,logout:()=>{c(null),o(null),localStorage.removeItem("token"),localStorage.removeItem("user")},register:f,isLoading:i,error:d},children:t})}function l(){let e=(0,s.useContext)(a);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},5879:function(e,t,n){n.d(t,{q:function(){return l},s:function(){return o}});var r=n(7437),s=n(2265),a=n(8333);let c=(0,s.createContext)(void 0);function l(e){let{children:t}=e,{token:n}=(0,a.a)(),l=(0,s.useRef)(null),[o,i]=(0,s.useState)(!1),[u,d]=(0,s.useState)(null),[m,h]=(0,s.useState)(null),[f,x]=(0,s.useState)(!1),g=(0,s.useRef)(null),p=(0,s.useRef)(0),j=(0,s.useRef)(!1),b=(0,s.useCallback)(()=>{let e=l.current;e&&(e.onopen=null,e.onmessage=null,e.onclose=null,e.onerror=null,(e.readyState===WebSocket.OPEN||e.readyState===WebSocket.CONNECTING)&&e.close(),l.current=null),g.current&&(clearTimeout(g.current),g.current=null)},[]),v=(0,s.useCallback)(()=>{g.current&&clearTimeout(g.current),p.current+=1,x(!0);let e=2e3*Math.pow(1.5,p.current-1);console.log("Scheduling reconnect attempt ".concat(p.current," in ").concat(e,"ms")),g.current=setTimeout(()=>{console.log("Attempting to reconnect (".concat(p.current,"/").concat(5,")")),N()},e)},[]),N=(0,s.useCallback)(()=>{if(n){b(),h(null),x(p.current>0);try{let e="".concat("wss://nrepserver.derrickml.com","?token=").concat(n);console.log("Connecting to WebSocket: ".concat(e));let t=new WebSocket(e);l.current=t,t.onopen=()=>{console.log("WebSocket connected successfully"),i(!0),h(null),x(!1),p.current=0,j.current=!1},t.onmessage=e=>{try{let t=JSON.parse(e.data);"status"===t.type&&d(t.data)}catch(e){console.error("Error parsing WebSocket message:",e)}},t.onclose=e=>{console.log("WebSocket disconnected with code: ".concat(e.code,", reason: ").concat(e.reason)),i(!1),1e3!==e.code&&p.current<5?v():p.current>=5&&(h("Maximum reconnection attempts reached. Please try manually reconnecting."),x(!1))},t.onerror=e=>{console.error("WebSocket error:",e),h("Failed to connect to the server. Please check your network connection."),i(!1)}}catch(e){console.error("Error creating WebSocket:",e),h("Failed to initialize WebSocket connection"),i(!1),v()}}},[n,b,v]),k=(0,s.useCallback)(()=>{p.current=0,x(!1),j.current=!1,N()},[N]),S=(0,s.useCallback)(async()=>{if(n&&!j.current){j.current=!0,console.log("Attempting to fetch status via REST API fallback");try{let e=await fetch("".concat("https://nrepserver.derrickml.com","/api/status"),{headers:{Authorization:"Bearer ".concat(n)}});if(e.ok){let t=await e.json();d(t),console.log("Successfully fetched status via REST API fallback")}}catch(e){console.error("Failed to fetch status via REST API fallback:",e)}}},[n]);return(0,s.useEffect)(()=>{if(n)return N(),()=>b();b(),i(!1),d(null)},[n,N,b]),(0,s.useEffect)(()=>{n&&!o&&m&&S()},[n,o,m,S]),(0,s.useEffect)(()=>()=>{b()},[b]),(0,r.jsx)(c.Provider,{value:{isConnected:o,statusData:u,reconnect:k,connectionError:m,isReconnecting:f},children:t})}function o(){let e=(0,s.useContext)(c);if(void 0===e)throw Error("useWebSocket must be used within a WebSocketProvider");return e}}}]);