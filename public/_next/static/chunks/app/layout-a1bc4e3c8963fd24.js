(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{1824:function(e,t,r){Promise.resolve().then(r.t.bind(r,2445,23)),Promise.resolve().then(r.bind(r,2082)),Promise.resolve().then(r.t.bind(r,3445,23))},2082:function(e,t,r){"use strict";r.r(t),r.d(t,{Providers:function(){return d}});var n=r(7437),o=r(8333),a=r(5879),s=r(743),c=r(4033),l=r(2265),i=r(9639);function u(e){let{children:t}=e,{user:r,isLoading:a}=(0,o.a)(),s=(0,c.useRouter)(),u=(0,c.usePathname)();return((0,l.useEffect)(()=>{a||r||"/login"===u||s.push("/login")},[r,a,s,u]),a)?(0,n.jsx)("div",{className:"d-flex justify-content-center align-items-center",style:{height:"100vh"},children:(0,n.jsx)(i.Z,{animation:"border",role:"status",variant:"primary",children:(0,n.jsx)("span",{className:"visually-hidden",children:"Loading..."})})}):r||"/login"===u?(0,n.jsx)(n.Fragment,{children:t}):null}function d(e){let{children:t}=e;return(0,n.jsx)(o.H,{children:(0,n.jsx)(a.q,{children:(0,n.jsx)(s.V,{children:(0,n.jsx)(u,{children:t})})})})}},743:function(e,t,r){"use strict";r.d(t,{V:function(){return l},p:function(){return i}});var n=r(7437),o=r(2265),a=r(8124),s=r(7679);let c=(0,o.createContext)(void 0);function l(e){let{children:t}=e,[r,l]=(0,o.useState)([]),i=e=>{l(t=>t.filter(t=>t.id!==e))};return(0,o.useEffect)(()=>{let e=[];return r.forEach(t=>{if(!1!==t.autohide){let r=setTimeout(()=>{i(t.id)},5e3);e.push(r)}}),()=>{e.forEach(e=>clearTimeout(e))}},[r]),(0,n.jsxs)(c.Provider,{value:{showToast:e=>{let t=Math.random().toString(36).substring(2,9);l(r=>[...r,{...e,id:t}])}},children:[t,(0,n.jsx)(a.Z,{position:"top-end",className:"p-3",style:{zIndex:1060},children:r.map(e=>(0,n.jsxs)(s.Z,{onClose:()=>i(e.id),bg:e.variant,delay:5e3,autohide:!1!==e.autohide,children:[(0,n.jsx)(s.Z.Header,{children:(0,n.jsx)("strong",{className:"me-auto",children:e.title})}),(0,n.jsx)(s.Z.Body,{className:"danger"===e.variant||"dark"===e.variant?"text-white":"",children:e.message})]},e.id))})]})}function i(){let e=(0,o.useContext)(c);if(void 0===e)throw Error("useToast must be used within a ToastProvider");return e}},8333:function(e,t,r){"use strict";r.d(t,{H:function(){return s},a:function(){return c}});var n=r(7437),o=r(2265);let a=(0,o.createContext)(void 0);function s(e){let{children:t}=e,[r,s]=(0,o.useState)(null),[c,l]=(0,o.useState)(null),[i,u]=(0,o.useState)(!0),[d,f]=(0,o.useState)(null);(0,o.useEffect)(()=>{let e=localStorage.getItem("token"),t=localStorage.getItem("user");e&&t&&(l(e),s(JSON.parse(t))),u(!1)},[]);let m=async(e,t)=>{u(!0),f(null);try{let r=await fetch("".concat("https://nrepserver.derrickml.com","/api/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}),n=await r.json();if(!r.ok)throw Error(n.error||"Login failed");l(n.token),s(n.user),localStorage.setItem("token",n.token),localStorage.setItem("user",JSON.stringify(n.user))}catch(e){f(e instanceof Error?e.message:"An unknown error occurred")}finally{u(!1)}},h=async(e,t,r)=>{u(!0),f(null);try{let n=await fetch("".concat("https://nrepserver.derrickml.com","/api/register"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(c)},body:JSON.stringify({username:e,email:t,password:r})}),o=await n.json();if(!n.ok)throw Error(o.error||"Registration failed")}catch(e){throw f(e instanceof Error?e.message:"An unknown error occurred"),e}finally{u(!1)}};return(0,n.jsx)(a.Provider,{value:{user:r,token:c,login:m,logout:()=>{s(null),l(null),localStorage.removeItem("token"),localStorage.removeItem("user")},register:h,isLoading:i,error:d},children:t})}function c(){let e=(0,o.useContext)(a);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},5879:function(e,t,r){"use strict";r.d(t,{q:function(){return c},s:function(){return l}});var n=r(7437),o=r(2265),a=r(8333);let s=(0,o.createContext)(void 0);function c(e){let{children:t}=e,{token:r}=(0,a.a)(),c=(0,o.useRef)(null),[l,i]=(0,o.useState)(!1),[u,d]=(0,o.useState)(null),[f,m]=(0,o.useState)(null),[h,v]=(0,o.useState)(!1),p=(0,o.useRef)(null),g=(0,o.useRef)(0),b=(0,o.useRef)(!1),x=(0,o.useCallback)(()=>{let e=c.current;e&&(e.onopen=null,e.onmessage=null,e.onclose=null,e.onerror=null,(e.readyState===WebSocket.OPEN||e.readyState===WebSocket.CONNECTING)&&e.close(),c.current=null),p.current&&(clearTimeout(p.current),p.current=null)},[]),y=(0,o.useCallback)(()=>{p.current&&clearTimeout(p.current),g.current+=1,v(!0);let e=2e3*Math.pow(1.5,g.current-1);console.log("Scheduling reconnect attempt ".concat(g.current," in ").concat(e,"ms")),p.current=setTimeout(()=>{console.log("Attempting to reconnect (".concat(g.current,"/").concat(5,")")),k()},e)},[]),k=(0,o.useCallback)(()=>{if(r){x(),m(null),v(g.current>0);try{let e="".concat("wss://nrepserver.derrickml.com","?token=").concat(r);console.log("Connecting to WebSocket: ".concat(e));let t=new WebSocket(e);c.current=t,t.onopen=()=>{console.log("WebSocket connected successfully"),i(!0),m(null),v(!1),g.current=0,b.current=!1},t.onmessage=e=>{try{let t=JSON.parse(e.data);"status"===t.type&&d(t.data)}catch(e){console.error("Error parsing WebSocket message:",e)}},t.onclose=e=>{console.log("WebSocket disconnected with code: ".concat(e.code,", reason: ").concat(e.reason)),i(!1),1e3!==e.code&&g.current<5?y():g.current>=5&&(m("Maximum reconnection attempts reached. Please try manually reconnecting."),v(!1))},t.onerror=e=>{console.error("WebSocket error:",e),m("Failed to connect to the server. Please check your network connection."),i(!1)}}catch(e){console.error("Error creating WebSocket:",e),m("Failed to initialize WebSocket connection"),i(!1),y()}}},[r,x,y]),S=(0,o.useCallback)(()=>{g.current=0,v(!1),b.current=!1,k()},[k]),E=(0,o.useCallback)(async()=>{if(r&&!b.current){b.current=!0,console.log("Attempting to fetch status via REST API fallback");try{let e=await fetch("".concat("https://nrepserver.derrickml.com","/api/status"),{headers:{Authorization:"Bearer ".concat(r)}});if(e.ok){let t=await e.json();d(t),console.log("Successfully fetched status via REST API fallback")}}catch(e){console.error("Failed to fetch status via REST API fallback:",e)}}},[r]);return(0,o.useEffect)(()=>{if(r)return k(),()=>x();x(),i(!1),d(null)},[r,k,x]),(0,o.useEffect)(()=>{r&&!l&&f&&E()},[r,l,f,E]),(0,o.useEffect)(()=>()=>{x()},[x]),(0,n.jsx)(s.Provider,{value:{isConnected:l,statusData:u,reconnect:S,connectionError:f,isReconnecting:h},children:t})}function l(){let e=(0,o.useContext)(s);if(void 0===e)throw Error("useWebSocket must be used within a WebSocketProvider");return e}},2445:function(){},3445:function(e){e.exports={style:{fontFamily:"'__Inter_d65c78', '__Inter_Fallback_d65c78'",fontStyle:"normal"},className:"__className_d65c78"}},9639:function(e,t,r){"use strict";var n=r(2744),o=r.n(n),a=r(2265),s=r(5956),c=r(7437);let l=a.forwardRef(({bsPrefix:e,variant:t,animation:r="border",size:n,as:a="div",className:l,...i},u)=>{e=(0,s.vE)(e,"spinner");let d=`${e}-${r}`;return(0,c.jsx)(a,{ref:u,...i,className:o()(l,d,n&&`${d}-${n}`,t&&`text-${t}`)})});l.displayName="Spinner",t.Z=l},7679:function(e,t,r){"use strict";r.d(t,{Z:function(){return y}});var n=r(2265),o=r(2744),a=r.n(o);let s=2147483648-1;var c=r(7496),l=r(2525),i=r(7437);let u={[c.d0]:"showing",[c.Ix]:"showing show"},d=n.forwardRef((e,t)=>(0,i.jsx)(l.Z,{...e,ref:t,transitionClasses:u}));d.displayName="ToastFade";var f=d,m=r(9605),h=r(5956),v=r(5754);let p=n.createContext({onClose(){}}),g=n.forwardRef(({bsPrefix:e,closeLabel:t="Close",closeVariant:r,closeButton:o=!0,className:s,children:c,...l},u)=>{e=(0,h.vE)(e,"toast-header");let d=(0,n.useContext)(p),f=(0,m.Z)(e=>{null==d||null==d.onClose||d.onClose(e)});return(0,i.jsxs)("div",{ref:u,...l,className:a()(e,s),children:[c,o&&(0,i.jsx)(v.Z,{"aria-label":t,variant:r,onClick:f,"data-dismiss":"toast"})]})});g.displayName="ToastHeader";let b=n.forwardRef(({className:e,bsPrefix:t,as:r="div",...n},o)=>(t=(0,h.vE)(t,"toast-body"),(0,i.jsx)(r,{ref:o,className:a()(e,t),...n})));b.displayName="ToastBody";let x=n.forwardRef(({bsPrefix:e,className:t,transition:r=f,show:o=!0,animation:c=!0,delay:l=5e3,autohide:u=!1,onClose:d,onEntered:m,onExit:v,onExiting:g,onEnter:b,onEntering:x,onExited:y,bg:k,...S},E)=>{e=(0,h.vE)(e,"toast");let w=(0,n.useRef)(l),j=(0,n.useRef)(d);(0,n.useEffect)(()=>{w.current=l,j.current=d},[l,d]);let N=function(){let e=function(){let e=(0,n.useRef)(!0),t=(0,n.useRef)(()=>e.current);return(0,n.useEffect)(()=>(e.current=!0,()=>{e.current=!1}),[]),t.current}(),t=(0,n.useRef)();return!function(e){let t=function(e){let t=(0,n.useRef)(e);return t.current=e,t}(e);(0,n.useEffect)(()=>()=>t.current(),[])}(()=>clearTimeout(t.current)),(0,n.useMemo)(()=>{let r=()=>clearTimeout(t.current);return{set:function(n,o=0){e()&&(r(),o<=s?t.current=setTimeout(n,o):function e(t,r,n){let o=n-Date.now();t.current=o<=s?setTimeout(r,o):setTimeout(()=>e(t,r,n),s)}(t,n,Date.now()+o))},clear:r,handleRef:t}},[])}(),C=!!(u&&o),T=(0,n.useCallback)(()=>{C&&(null==j.current||j.current())},[C]);(0,n.useEffect)(()=>{N.set(T,w.current)},[N,T]);let R=(0,n.useMemo)(()=>({onClose:d}),[d]),P=!!(r&&c),_=(0,i.jsx)("div",{...S,ref:E,className:a()(e,t,k&&`bg-${k}`,!P&&(o?"show":"hide")),role:"alert","aria-live":"assertive","aria-atomic":"true"});return(0,i.jsx)(p.Provider,{value:R,children:P&&r?(0,i.jsx)(r,{in:o,onEnter:b,onEntering:x,onEntered:m,onExit:v,onExiting:g,onExited:y,unmountOnExit:!0,children:_}):_})});x.displayName="Toast";var y=Object.assign(x,{Body:b,Header:g})},8124:function(e,t,r){"use strict";var n=r(2744),o=r.n(n),a=r(2265),s=r(5956),c=r(7437);let l={"top-start":"top-0 start-0","top-center":"top-0 start-50 translate-middle-x","top-end":"top-0 end-0","middle-start":"top-50 start-0 translate-middle-y","middle-center":"top-50 start-50 translate-middle","middle-end":"top-50 end-0 translate-middle-y","bottom-start":"bottom-0 start-0","bottom-center":"bottom-0 start-50 translate-middle-x","bottom-end":"bottom-0 end-0"},i=a.forwardRef(({bsPrefix:e,position:t,containerPosition:r,className:n,as:a="div",...i},u)=>(e=(0,s.vE)(e,"toast-container"),(0,c.jsx)(a,{ref:u,...i,className:o()(e,t&&l[t],r&&`position-${r}`,n)})));i.displayName="ToastContainer",t.Z=i}},function(e){e.O(0,[363,971,938,744],function(){return e(e.s=1824)}),_N_E=e.O()}]);