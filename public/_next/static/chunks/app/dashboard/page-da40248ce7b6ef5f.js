(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{2832:function(e,s,t){Promise.resolve().then(t.bind(t,7525))},7525:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return k}});var a=t(7437),i=t(2265),l=t(5879),n=t(8333);async function r(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{method:t="GET",body:a,token:i}=s,l={"Content-Type":"application/json"};i&&(l.Authorization="Bearer ".concat(i));let n={method:t,headers:l,body:a?JSON.stringify(a):void 0},r=await fetch("".concat("https://nrepserver.derrickml.com").concat(e),n),c=await r.json();if(!r.ok)throw Error(c.error||"API request failed");return c}let c={getStatus:e=>r("/api/status",{token:e}),restartServer:e=>r("/api/restart",{method:"POST",token:e}),getFailureReason:e=>r("/api/failure-reason",{token:e}),getSystemInfo:e=>r("/api/system-info",{token:e}),registerUser:(e,s,t,a)=>r("/api/register",{method:"POST",body:{username:e,email:s,password:t},token:a})};var d=t(1301),o=t(743),m=t(2824),h=t(6716),u=t(9639),x=t(382),j=t(8597),f=t(4434),g=t(6581),v=t(2402),N=t(261),Z=t(8784),y=t(6714),b=t(2894),p=t(998),S=t(6141),w=t(2104),T=t(3008),z=t(3086);function k(){var e,s,t;let{statusData:r,isConnected:k,reconnect:E,connectionError:C,isReconnecting:R}=(0,l.s)(),{token:F}=(0,n.a)(),{showToast:L}=(0,o.p)(),[B,H]=(0,i.useState)(!1),[P,O]=(0,i.useState)(null),[D,I]=(0,i.useState)(null),[U,M]=(0,i.useState)(!1),[_,A]=(0,i.useState)(!1),Q=(0,i.useCallback)(async()=>{if(F){M(!0);try{let e=await c.getFailureReason(F);O(e.reason)}catch(e){console.error("Error fetching failure reason:",e),L({title:"Error",message:"Failed to fetch failure reason",variant:"danger"})}finally{M(!1)}}},[F,L]);(0,i.useEffect)(()=>{F&&(null==r?void 0:r.status)==="DOWN"&&Q()},[F,null==r?void 0:r.status,Q]);let W=(0,i.useCallback)(async()=>{if(F){A(!0);try{let e=await c.getSystemInfo(F);I(e.info)}catch(e){console.error("Error fetching system info:",e),L({title:"Error",message:"Failed to fetch system information",variant:"danger"})}finally{A(!1)}}},[F,L]),q=async()=>{if(F){H(!0);try{await c.restartServer(F),L({title:"Success",message:"MySQL restart command issued successfully",variant:"success"})}catch(e){console.error("Error restarting server:",e),L({title:"Error",message:"Failed to restart MySQL server",variant:"danger"})}finally{H(!1)}}},G=e=>e?new Date(e).toLocaleString():"Never";return(0,a.jsx)(d.Z,{children:(0,a.jsxs)(m.Z,{fluid:!0,children:[(0,a.jsxs)("div",{className:"d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-4",children:[(0,a.jsx)("h1",{className:"h3 mb-3 mb-md-0",children:"Dashboard"}),(0,a.jsxs)("div",{className:"d-flex gap-2",children:[(0,a.jsx)(h.Z,{variant:k?"outline-success":"outline-danger",size:"sm",onClick:()=>{L({title:"Reconnecting",message:"Attempting to reconnect to the server...",variant:"info"}),E()},disabled:R,children:R?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u.Z,{as:"span",animation:"border",size:"sm",role:"status","aria-hidden":"true",className:"me-2"}),"Reconnecting..."]}):(0,a.jsxs)(a.Fragment,{children:[k?(0,a.jsx)(N.Z,{size:16,className:"me-2"}):(0,a.jsx)(Z.Z,{size:16,className:"me-2"}),k?"Connected":"Reconnect"]})}),(0,a.jsxs)(h.Z,{variant:"outline-secondary",size:"sm",onClick:W,children:[(0,a.jsx)(y.Z,{size:16,className:"me-2"}),"System Info"]})]})]}),!k&&(0,a.jsxs)(x.Z,{variant:"warning",className:"d-flex align-items-center mb-4",children:[(0,a.jsx)(b.Z,{size:20,className:"me-2"}),(0,a.jsxs)("div",{children:[(0,a.jsx)(x.Z.Heading,{className:"h5",children:"Connection Status"}),(0,a.jsxs)("p",{className:"mb-0",children:[C||"WebSocket connection lost. Real-time updates are not available.",!R&&" Click the reconnect button to try again."]}),r&&(0,a.jsx)("p",{className:"mb-0 mt-2 small text-muted",children:(0,a.jsx)("i",{children:"Showing last known data. Some information may be outdated."})})]})]}),(0,a.jsxs)(j.Z,{className:"g-3 mb-4",children:[(0,a.jsx)(f.Z,{md:6,lg:3,children:(0,a.jsx)(g.Z,{children:(0,a.jsxs)(g.Z.Body,{children:[(0,a.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[(0,a.jsx)(g.Z.Title,{className:"h6 mb-0",children:"Status"}),(0,a.jsx)("div",{className:"status-indicator ".concat((null==r?void 0:r.status)==="UP"?"up":(null==r?void 0:r.status)==="DOWN"?"down":"unknown"," pulse")})]}),(0,a.jsxs)("div",{className:(null==r?void 0:r.status)==="UP"?"status-up":"status-down",style:{fontSize:"1.5rem"},children:[(null==r?void 0:r.status)||"UNKNOWN",!k&&r&&(0,a.jsx)("span",{className:"ms-2 small text-muted",children:"(Last known)"})]}),(0,a.jsx)(g.Z.Text,{className:"text-muted small",children:"MySQL Server Status"})]})})}),(0,a.jsx)(f.Z,{md:6,lg:3,children:(0,a.jsx)(g.Z,{children:(0,a.jsxs)(g.Z.Body,{children:[(0,a.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[(0,a.jsx)(g.Z.Title,{className:"h6 mb-0",children:"Uptime"}),(0,a.jsx)(p.Z,{size:16,className:"text-muted"})]}),(0,a.jsx)("div",{style:{fontSize:"1.5rem"},className:"fw-bold",children:(null==r?void 0:r.metrics)?(t=r.metrics.uptime,"".concat(t.toFixed(2),"%")):"0%"}),(0,a.jsx)(g.Z.Text,{className:"text-muted small",children:"Server Availability"})]})})}),(0,a.jsx)(f.Z,{md:6,lg:3,children:(0,a.jsx)(g.Z,{children:(0,a.jsxs)(g.Z.Body,{children:[(0,a.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[(0,a.jsx)(g.Z.Title,{className:"h6 mb-0",children:"Last Restart"}),(0,a.jsx)(S.Z,{size:16,className:"text-muted"})]}),(0,a.jsx)("div",{style:{fontSize:"1.5rem"},className:"fw-bold",children:(null==r?void 0:r.metrics)?G(r.metrics.lastRestart).split(",")[0]:"Never"}),(0,a.jsx)(g.Z.Text,{className:"text-muted small",children:(null==r?void 0:null===(e=r.metrics)||void 0===e?void 0:e.lastRestart)?G(r.metrics.lastRestart).split(",")[1]:""})]})})}),(0,a.jsx)(f.Z,{md:6,lg:3,children:(0,a.jsx)(g.Z,{children:(0,a.jsxs)(g.Z.Body,{children:[(0,a.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[(0,a.jsx)(g.Z.Title,{className:"h6 mb-0",children:"Failures"}),(0,a.jsx)(w.Z,{size:16,className:"text-muted"})]}),(0,a.jsx)("div",{style:{fontSize:"1.5rem"},className:"fw-bold",children:(null==r?void 0:null===(s=r.metrics)||void 0===s?void 0:s.failureCount)||0}),(0,a.jsx)(g.Z.Text,{className:"text-muted small",children:"Total Detected Failures"})]})})})]}),(0,a.jsxs)(j.Z,{className:"g-4",children:[(0,a.jsx)(f.Z,{md:6,children:(0,a.jsxs)(g.Z,{children:[(0,a.jsx)(g.Z.Header,{children:(0,a.jsx)(g.Z.Title,{className:"h5 mb-0",children:"Recent Status History"})}),(0,a.jsx)(g.Z.Body,{children:(null==r?void 0:r.history)&&r.history.length>0?(0,a.jsx)(v.Z,{variant:"flush",children:r.history.slice(-10).reverse().map((e,s)=>(0,a.jsxs)(v.Z.Item,{className:"d-flex justify-content-between align-items-center py-3",children:[(0,a.jsxs)("div",{className:"d-flex align-items-center",children:["UP"===e.status?(0,a.jsx)(T.Z,{size:16,className:"text-success me-2"}):(0,a.jsx)(w.Z,{size:16,className:"text-danger me-2"}),(0,a.jsx)("span",{className:"UP"===e.status?"text-success":"text-danger",children:e.status})]}),(0,a.jsx)("span",{className:"text-muted small",children:new Date(e.timestamp).toLocaleString()})]},s))}):(0,a.jsx)("div",{className:"d-flex justify-content-center align-items-center",style:{height:"200px"},children:(0,a.jsx)("p",{className:"text-muted",children:"No history available"})})})]})}),(0,a.jsx)(f.Z,{md:6,children:(0,a.jsxs)(g.Z,{children:[(0,a.jsx)(g.Z.Header,{children:(0,a.jsx)(g.Z.Title,{className:"h5 mb-0",children:"Actions"})}),(0,a.jsxs)(g.Z.Body,{className:"d-flex flex-column gap-3",children:[(0,a.jsx)(h.Z,{variant:"danger",onClick:q,disabled:B,children:B?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u.Z,{as:"span",animation:"border",size:"sm",role:"status","aria-hidden":"true",className:"me-2"}),"Restarting..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(z.Z,{size:16,className:"me-2"}),"Restart MySQL Server"]})}),(null==r?void 0:r.status)==="DOWN"&&(0,a.jsx)(x.Z,{variant:"danger",children:(0,a.jsxs)("div",{className:"d-flex",children:[(0,a.jsx)(b.Z,{size:20,className:"me-2"}),(0,a.jsxs)("div",{children:[(0,a.jsx)(x.Z.Heading,{className:"h6",children:"MySQL Server is Down"}),(0,a.jsx)("p",{className:"mb-0 small",children:"The server is currently not responding. You can try restarting it or check the logs for more information."})]})]})}),P&&(0,a.jsxs)(g.Z,{className:"bg-light",children:[(0,a.jsx)(g.Z.Header,{className:"py-2",children:(0,a.jsx)(g.Z.Title,{className:"h6 mb-0",children:"Failure Reason"})}),(0,a.jsx)(g.Z.Body,{children:(0,a.jsx)("pre",{className:"bg-light p-2 small",style:{maxHeight:"150px",overflow:"auto"},children:U?"Loading...":P})})]}),D&&(0,a.jsxs)(g.Z,{className:"bg-light",children:[(0,a.jsx)(g.Z.Header,{className:"py-2",children:(0,a.jsx)(g.Z.Title,{className:"h6 mb-0",children:"System Information"})}),(0,a.jsx)(g.Z.Body,{children:(0,a.jsx)("pre",{className:"bg-light p-2 small",style:{maxHeight:"150px",overflow:"auto"},children:_?"Loading...":D})})]})]})]})})]})]})})}},743:function(e,s,t){"use strict";t.d(s,{V:function(){return c},p:function(){return d}});var a=t(7437),i=t(2265),l=t(8124),n=t(7679);let r=(0,i.createContext)(void 0);function c(e){let{children:s}=e,[t,c]=(0,i.useState)([]),d=e=>{c(s=>s.filter(s=>s.id!==e))};return(0,i.useEffect)(()=>{let e=[];return t.forEach(s=>{if(!1!==s.autohide){let t=setTimeout(()=>{d(s.id)},5e3);e.push(t)}}),()=>{e.forEach(e=>clearTimeout(e))}},[t]),(0,a.jsxs)(r.Provider,{value:{showToast:e=>{let s=Math.random().toString(36).substring(2,9);c(t=>[...t,{...e,id:s}])}},children:[s,(0,a.jsx)(l.Z,{position:"top-end",className:"p-3",style:{zIndex:1060},children:t.map(e=>(0,a.jsxs)(n.Z,{onClose:()=>d(e.id),bg:e.variant,delay:5e3,autohide:!1!==e.autohide,children:[(0,a.jsx)(n.Z.Header,{children:(0,a.jsx)("strong",{className:"me-auto",children:e.title})}),(0,a.jsx)(n.Z.Body,{className:"danger"===e.variant||"dark"===e.variant?"text-white":"",children:e.message})]},e.id))})]})}function d(){let e=(0,i.useContext)(r);if(void 0===e)throw Error("useToast must be used within a ToastProvider");return e}}},function(e){e.O(0,[363,930,63,276,527,971,938,744],function(){return e(e.s=2832)}),_N_E=e.O()}]);